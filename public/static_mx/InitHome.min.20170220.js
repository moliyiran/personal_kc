var Charts={};var CardListFirst=[];var ChartListFirst=[];window.onbeforeunload=function(e){if(isLogOut){return}if($("#myTab>li[tagid]").length>0){return"存在未关闭的选项卡，离开此页可能会导致未保存数据丢失，您确定离开此页吗？"}};$(function(){InitLeftMenu();InitTab();initQuickSearch();ace.settings.navbar_fixed(null,true);ace.settings.sidebar_fixed(null,true);$(window).triggerHandler("resize.navbar");InitSignalR();$("#editpass").click(function(){$("#editPassWindow").dialog("open")});$("#btnCancel").click(function(){closePwd()});$(".easy-pie-chart.percentage").each(function(){var e=$(this).closest(".infobox");var t=$(this).data("color")||(!e.hasClass("infobox-dark")?e.css("color"):"rgba(255,255,255,0.95)");var a=t=="rgba(255,255,255,0.95)"?"rgba(255,255,255,0.25)":"#E2E2E2";var n=parseInt($(this).data("size"))||50;$(this).easyPieChart({barColor:t,trackColor:a,scaleColor:false,lineCap:"butt",lineWidth:parseInt(n/10),animate:/msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase())?false:1e3,size:n})});$("body").click(function(){$("div.RMclickmenu").css({display:"none"})});$("div.RMclickmenu").unbind("mouseleave").bind("mouseleave",function(e){$("div.RMclickmenu").css({display:"none"})});resize_sidebar();resizetabs();resizecharts();resize_dhbar();if(isZXTX=="False"){setOutTim()}if($.browser.isMoveBrowser==false){$("#AppDown").popover({html:true,animation:true,container:"body",placement:"left",trigger:"hover",content:'<div style="width=:100px; height=100px;"><img src="/Images/mxxzewm.png" width="96" height="96" class="img-thumbnail center-block" alt="梦想云APP安装"></div>'})}workBook();ShowInform();ShowFastMenu(HotMenuData);$("#fastMenu").on("reload.ace.widget",function(){var e=$(this);GetFastMenu(e)});$("#Chart").find("li.dropdown-li").bind("click",function(e){DropdownChartSetting(e)})});var ex_afterCMSuccess=function(){if(CardListFirst.length>0){RefreshCm(CardListFirst[0]);CardListFirst.shift()}};var ex_afterCSSuccess=function(){if(ChartListFirst.length>0){RefreshCs(ChartListFirst[0]);ChartListFirst.shift()}};var initnewsAni=function(){var e=new ifeng_Scroll("MainInfo","pre_66","next_66");e.Speed=10;e.IsSmoothScroll=false;e.PauseTime=8e3;e.Direction="E";e.Step=1;e.ControllerType="none";e.BackCall=null;e.Init();e.Start()};var learnLimit=function(){$.messager.alert("","您正在使用体验版，不允许使用此功能","");return};var hidePageLoad=function(){$("._pageLoad").addClass("hidden")};var isLogOut=false;var logout=function(){$.messager.confirm("系统提示","您确定要退出本次登录吗?",function(e){if(e){isLogOut=true;if(userconn&&userconn.connection.state==1){userconn.server.cutconn()}location.href="/Account/LogOff"}})};var btnCharSearch=function(){Charting();$("#PopoverSearch").popover("hide")};var showDBSize=function(){$.ajax({url:"/DBOper/GetDBSizeInfo",dataType:"json",type:"POST",success:function(e){if(e.error){alert(e.error)}else{$("#dbsize").css({display:"block"});$("#dbsize  span.dbsizeinfo").text(e.showinfo);$("#dbsize  div.dbsizeprocess").width($("#dbsize").width()*e.percent)}}})};var reloadMenu=null;var lockscreen_waitTime=0;var timeOutTirm=null;var parment;function setOutTim(){if(timeOutTirm==null){timeOutTirm=window.setInterval(addTime,1e3*60)}}function addTime(){if(lockscreen_waitTime>=10){clearTime()}else{lockscreen_waitTime++}}function clearTime(){if(timeOutTirm!==null){window.clearInterval(timeOutTirm);setTimeout(function(){lockscreen_waitTime=0;userLock()},10)}}var userLock=function(){$(".lock-screen").remove();var e=$(window).height();var t=$(window).width();var a=$('<div class="lock-screen top"></div>').appendTo($("body"));var n=$('<div class="lock-screen bottom"></div>').appendTo($("body"));a.css({top:-e/2});n.css({top:e});a.animate({top:0},500);$("body").css({overflow:"hidden"});n.animate({top:e/2},500,function(){$("body >*").addClass("lock-screen-hidden");var e=$('<div class="lock-screen layout"></div>').appendTo($("body"));var t=$('<div class="layout"><div class="content"></div></div>').appendTo(e);t=$(t.find("div.content"));$('<div class="lock-screen-img"><img class="photo" src="" /></div>').appendTo(t);var a=$('<div class="text-center m-top-sm"><h4  class ="username"></h4></div>').appendTo(t);if(isLearn=="true"){$('<h4 style="color:#acacac">体验版  输入任意密码解锁</h4>').appendTo(a)}var n=$('<div class="input-group"></div>').appendTo(a);$('<input class="form-control pwd" type="password" placeholder="请输入密码解锁" /><span class="input-group-btn"><button class="btn btn-sm btn-success no-border login" type="button"><i class="ace-icon fa fa-unlock-alt bigger-110"></i></button></span>').appendTo(n);$('<h4 class="hidden error">您输入的密码不正确！</h4>').appendTo(a);t.find("button.login").on("click",function(){unlock()});t.find("input.pwd").on("keydown",function(e){t.find(".error").addClass("hidden");var a=window.event?true:false;var n;var i;if(!e){return}if(a){n=e.keyCode;i=e}else{n=e.which;i=e}if(n==13){unlock()}});e.showLoading("获取登录信息...");if(userconn&&userconn.connection.state==1){userconn.server.cutconn();$.connection.hub.stop();userconn=null}$.ajax({type:"POST",url:"/Account/LockLogOff",dataType:"json",success:function(a){timeOutTirm=null;e.hideLoading();if(a.error){e.find(".error").removeClass("hidden").text("与服务器断开连接！");return}else{parment=a;t.find("img.photo").attr("src",parment.photo);t.find(".username").html(parment.UserName);t.find("input.pwd").focus()}},error:function(){e.find(".error").removeClass("hidden").text("与服务器断开连接！");return}})})};var unlock=function(){var e=$(window).height();var t=$(window).width();var a=$(".lock-screen.layout");a.showLoading("密码匹配...");$.ajax({type:"POST",url:"/Account/TryPassword",data:{isZXTX:parment.isZXTX,TenantID:parment.TenantID,UserCode:parment.UserCode,UserType:parment.UserType,PassWord:a.find("input.pwd").val()},dataType:"json",success:function(t){a.hideLoading();if(t.error){a.find(".error").removeClass("hidden").text(t.error);return}if(t){var n=$(".lock-screen.top");var i=$(".lock-screen.bottom");a.remove();$("body >*").removeClass("lock-screen-hidden");n.animate({top:-e/2},500);i.animate({top:e},500,function(){$("body").css({overflow:"auto"});$(".lock-screen").remove();setOutTim()});InitSignalR()}else{a.find("input.pwd").val("");a.find(".error").removeClass("hidden").text("您输入的密码不正确！")}}})};var exresize=function(){resize_dhbar();resize_sidebar();resizetabs();resizecharts()};var resizetabs=function(){var e=$(window).width();var t=$(window).height();var a=$("#myTabContent").offset();$("#myTabContent").find("div.tab-pane.fade.active").height(t-a.top-4).width(e-a.left);$("#myTabContent iframe.iframe_tabpage").height(t-a.top-4)};var resizecharts=function(){$.each(Charts,function(e,t){if(t){t.redraw()}})};var resize_sidebar=function(){var e=$(window).height();if(!$.browser.useapp){if($("#sidebar").height()+$("#sidebar").offset().top>e){$("#sidebar").addClass("mx-sidebar");$("#sidebar").removeClass("compact")}}else{$("#sidebar").removeClass("compact");$("#sidebar li.hover").removeClass("hover")}};var userconn=null;function InitSignalR(){userconn=$.connection.userconn;initSignalREvents(userconn);$.connection.hub.start().done(function(){userconn.server.conn().done(function(e){$("#onlineusercount").text(e)})})}var initSignalREvents=function(e){if(!e){return}e.client.userConn=function(e){$.gritter.add({text:"<h4>"+e.username+"</h4><h5>于 "+e.time+" 登陆</h5>",image:e.image,sticky:false,time:"",class_name:"gritter-info"});$("#onlineusercount").text(e.usercount)};e.client.userCut=function(e){$.gritter.add({text:"<h4>"+e.username+"</h4><h5>于 "+e.time+" 退出登陆</h5>",image:e.image,sticky:false,time:"",class_name:"gritter-error"});$("#onlineusercount").text(e.usercount)};e.client.heCut=function(e){if(userconn&&userconn.connection.state==1){userconn.server.cutconn()}isLogOut=true;location.href="/Account/LogOff"}};function InitLeftMenu(){SetMenusNew()}function SetMenusNew(){$.each(menus,function(e,t){var a=$(getMenuBtn(t));a.appendTo("#menubar")});$("#sidebar li").addClass("hover");$("li.menuclick>a","#menubar").on("click.menuclick touchend.menuclick",function(){$(".hover-show.hover-shown","#menubar").removeClass("hover-show hover-shown");var e=$(this);if(!e.attr("url")){return}var t="/"+e.attr("url");var a=e.attr("objid");var n=e.text();var i=e.attr("icon");if(i=="null"){i=""}var r=e.attr("tagid");hidemenu();setTimeout(addTab(r,n,t,i,a),100)});setTimeout(function(){ex_afterCMSuccess();ex_afterCSSuccess()},1e3)}var getMenuBtn=function(e){var t="";var a="";if(e.treedata!=null&&e.treedata.length>0){t="dropdown-toggle";a='<b class="arrow fa fa-angle-right"></b>'}var n='<li name="PMenu"><a name="item" href="###" class="'+t+'" tagid="'+e.id+'"> <i class="menu-icon fa '+e.iconCls+'"></i><span class="menu-text">'+e.title+" </span>"+a+'</a><b class="arrow"></b>';if(e.treedata){n=n+'	<ul class="submenu">';$.each(e.treedata,function(e,t){n=n+getMenuStr(t)});n=n+"</ul>"}n=n+"</li>";return n};var getMenuStr=function(e){var t="";var a="";var n="";var i="";if(e.children!=null&&e.children.length>0){t="dropdown-toggle";a='<b class="arrow fa fa-angle-right"></b>'}else{n='url="'+e.attributes.url+'" objid ="'+e.attributes.objid+'" icon="'+e.iconCls+'"  ';if(e.attributes.url){i="menuclick"}}var r='<li  class="'+i+'"><a name="item" href="###" class="'+t+'" '+n+' tagid="'+e.id+'"> <i class="menu-icon fa '+e.iconCls+'"></i>'+e.text+" "+a+'</a><b class="arrow"></b>';if(e.children){r=r+'	<ul class="submenu">';$.each(e.children,function(e,t){r=r+getMenuStr(t)});r=r+"</ul>"}r=r+"</li>";return r};var activeMenu=function(e){$("li[name='PMenu']").removeClass("active");$('a[tagid="'+e+'"][name="item"]',"#menubar").closest("li[name='PMenu']").addClass("active")};var getMenuByID=function(e){};function InitTab(){$("a","#myTab>li:first").tab("show");$("#myTab").tabdrop({text:'更多<i class="ace-icon fa fa-caret-down bigger-110 width-auto"></i>'}).on("shown.bs.tab",function(e){var t=$($(e.target).attr("href"));if(isGWXF=="False"){$("#home-help").attr("href","/Home/goToHelp?id="+$(e.target).attr("tagid"))}$("iframe",t).each(function(){if(this.contentWindow&&this.contentWindow.new_resize){this.contentWindow.new_resize()}if(this.contentWindow&&this.contentWindow.smallscreen_reset){this.contentWindow.smallscreen_reset()}});resize_dhbar()})}var resizeTab=function(){};function RefThisTab(){var e=$($("#myTab").find("li.active"));$("#tab-"+e.attr("tagid")).find("._pageLoad").removeClass("hidden");var t=$("#ifarme-"+e.attr("tagid"));t.attr("src",t.attr("src"))}function CloseThisTab(){var e=$($("#myTab").find("li.active"));closeTab(e)}function CloseAllTab(e){var t=$("#myTab").find("li");$.each(t,function(t,a){if(!$(a).hasClass("active")){if($(a).attr("tagid")!=null){closeTab($(a),true)}}else{if(e!=null){closeTab($(a),true)}}})}function addTabByIDWithParams(e,t){var a=$('a[name="item"][tagid="'+e+'"]');if(a.length<=0){return}var n=a.text();var i="/"+a.attr("url")+"?PageConnect=true";if(!!t,t.length>0){$.each(t,function(e,t){i=i+"&"+(t.key+"=")+encodeURI(t.val)})}var r=a.attr("icon");var o=a.attr("objid");var s=$('[tagid="'+e+'"]',"#myTab");if(s.length>0){$.messager.confirm("","您需要联查至的页面已打开,重新打开将会刷新该页面。是否确定要联查至该页面？",function(t){if(t){$("a",s).tab("show");activeMenu(e);$("#tab-"+e).find("._pageLoad").removeClass("hidden");$("#ifarme-"+e).attr("src",i)}});return}addTab(e,n,i,r,o)}function addTabByID(e){var t=$('a[name="item"][tagid="'+e+'"]');if(t.length<=0){return}var a=t.text();var n="/"+t.attr("url")+"?FastOpen=true";var i=t.attr("icon");var r=t.attr("objid");addTab(e,a,n,i,r)}function addTabByCountMark(e,t){if(!e)return;var a=$('a[name="item"][tagid="'+e+'"]');if(a.length<=0){return}var n=a.text();var i="/"+a.attr("url")+"?Type="+t;var r=a.attr("icon");var o=a.attr("objid");var s=$('[tagid="'+e+'"]',"#myTab");if(s.length>0){$("a",s).tab("show");activeMenu(e);$("#ifarme-"+e).attr("src",i);return}addTab(e,n,i,r,o)}function addTabByIDAndParam(e,t){var a=$('a[name="item"][tagid="'+e+'"]');if(a.length<=0){return}var n=a.text();var i=a.attr("icon");var r="/"+a.attr("url")+t;var o=a.attr("objid");addTab(e,n,r,i,o)}function addTab(e,t,a,n,i){var r=$('[tagid="'+e+'"]',"#myTab");if(r.length>0){$("a",r).tab("show");activeMenu(e);if(e=="printid"){var o=$("#ifarme-printid");o.attr("src",a)}return}$.ajax({type:"POST",url:"/HotMenu/AddHotMenu",data:{MenuID:e},dataType:"json",success:function(e){}});var s='<li tagid="'+e+'"><a data-toggle="tab" href="#tab-'+e+'" tagid="'+e+'"><i class="green ace-icon fa '+n+'"></i>'+t+" </a></li>";r=$(s).bind("contextmenu",function(e){var t=!e?window.event:e;e.preventDefault();return false}).mouseup(function(e){if(e.which==3){e.preventDefault();$("a",$(this)).tab("show");var t=$("div.RMclickmenu");var a=e.clientX;var n=e.clientY;if(n+t.height()>$(document).height()){n=e.clientY-t.height()}t.css({left:a,top:n,display:"block"})}});$("#myTab").append(r);if(e!="menuFirstPage"){var l='<i name="tabclose" class="ace-icon fa fa-remove fa-lg"></i>';l=$(l).appendTo($("a",r));l.bind("mouseenter",function(){$(this).addClass("red")}).bind("mouseleave",function(){$(this).removeClass("red")}).bind("click",function(){closeTabByA(this);return false})}var c='<div id="tab-'+e+'" class="tab-pane fade" ><iframe id="ifarme-'+e+'" objid = "'+i+'"  icon="'+n+'" title="'+t+'" class="iframe_tabpage"  frameborder="0"  src="'+a+'" style="width:100%;" helpurl></iframe><div style="background-color:white;position: absolute;top: 0px;bottom: 0px;right: 0px;left: 0px;text-align: center;min-height: 100%;" class="_pageLoad"><div style="position: absolute; left: 45%;top: 45%;"><div style=" background-image :url(/Images/loading.gif);height: 32px;width: 32px;background-repeat:no-repeat;margin: auto;"></div><h4>正在为您加载页面...</h4></div></div></div>';if($.connection.hub){$.connection.hub.stop()}var d=$(c).appendTo("#myTabContent");$("a",r).tab("show");$("iframe.iframe_tabpage").off("load.page").on("load.page",function(){setTimeout(function(){$.connection.hub.start().done(function(){if(userconn){userconn.server.onlyconn()}})},100)});$("#myTab").tabdrop("layout");activeMenu(e);resize_dhbar();resizetabs()}var showFirstPage=function(){var e=$("#tab-FirstPage");$("a",e).tab("show")};function closeTabByA(e){var t=$(e).closest("li");closeTab(t)}function closeTab(e,t){var a=e.attr("tagid");var n=$("#tab-"+a);var i=n.find("iframe");if(i&&i.length>0){i[0].contentWindow.document.write("");if(i[0].contentWindow.document.clear){i[0].contentWindow.document.clear()}i[0].contentWindow.close();i.find("*").remove();i.remove();if($.browser.msie){CollectGarbage()}}n.remove();if(e.hasClass("active")){if(e.prev("li").length>0){$("a",e.prev("li")).tab("show")}else if(e.next("li").length>0){$("a",e.next("li")).tab("show")}activeMenu(a)}e.remove();if(t){}else{$("#myTab").tabdrop("layout")}}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(e)){e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in t){if(new RegExp("("+a+")").test(e)){e=e.replace(RegExp.$1,RegExp.$1.length==1?t[a]:("00"+t[a]).substr((""+t[a]).length))}}return e};function msgShow(e,t,a){$.messager.alert(e,t,a)}function LineChartsSearchUrl(e,t){$("#Chart"+t).showLoading();$.ajax({url:e.url,data:{BillDateFrom:e.BillDateFrom,BillDateTo:e.BillDateTo,BillType:e.BillType,DepID:e.DepID,PID:e.PID,XSTypeID:e.XSTypeID,CorpID:e.CorpID,IsYear:e.IsYear,IsMonth:e.IsMonth,IsDay:e.IsDay},dataType:"json",type:"POST",success:function(a){var n=[];var i="day";if(e.IsYear){i="year";$("#Ctitle"+t).html("往年")}if(e.IsMonth){i="month";$("#Ctitle"+t).html(a[0].iYear+"年")}if(e.IsDay){i="day";$("#Ctitle"+t).html(a[0].iYear+"年"+a[0].iMonth+"月")}var r=0;$.each(a,function(e,t){r=r+parseFloat(t.TotalMoney);if(i=="day"){n.push({x:t.iDay,y:formatMoneyWithZero(t.TotalMoney)})}else if(i=="month"){n.push({x:t.iMonth,y:formatMoneyWithZero(t.TotalMoney)})}else if(i=="year"){n.push({x:t.iYear,y:formatMoneyWithZero(t.TotalMoney)})}});$("#TotalMoney"+t).html("￥"+formatMoneyWithZero(r)+"元");if(i=="year"){xmax=(new Date).getFullYear()+1;xmin=xmax-7}$("#Charts"+t).children().remove();Charts[t]=Morris.Line({element:"Charts"+t,data:n,xkey:"x",grid:false,ykeys:"y",labels:[e.Chartslabels],lineColors:[e.ChartslineColors],gridTextColor:"#fff",parseTime:false,dateFormat:function(e){return e;if(i=="day"){return new Date(e).format("dd").toString()+"日"}else if(i=="month"){return new Date(e).format("MM").toString()+"月"}else if(i=="year"){return new Date(e).format("yyyy").toString()+"年"}},hideHover:"auto"});$("#Chart"+t).hideLoading()}})}function AreaChartsSearchUrl(e,t){$("#Chart"+t).showLoading();$.ajax({url:e.url,data:{BillDateFrom:e.BillDateFrom,BillDateTo:e.BillDateTo,BillType:e.BillType,DepID:e.DepID,PID:e.PID,XSTypeID:e.XSTypeID,CorpID:e.CorpID,IsYear:e.IsYear,IsMonth:e.IsMonth,IsDay:e.IsDay},dataType:"json",type:"POST",success:function(a){var n=[];var i="day";if(e.IsYear){i="year";$("#Ctitle"+t).html("往年")}if(e.IsMonth){i="month";$("#Ctitle"+t).html(a[0].iYear+"年")}if(e.IsDay){i="day";$("#Ctitle"+t).html(a[0].iYear+"年"+a[0].iMonth+"月")}var r=0;$.each(a,function(e,t){r=r+parseFloat(t.TotalMoney-t.FCCB);if(i=="day"){n.push({x:t.iDay,y:formatMoneyWithZero(t.TotalMoney),y1:formatMoneyWithZero(t.FCCB)})}else if(i=="month"){n.push({x:t.iMonth,y:formatMoneyWithZero(t.TotalMoney),y1:formatMoneyWithZero(t.FCCB)})}else if(i=="year"){n.push({x:t.iYear,y:formatMoneyWithZero(t.TotalMoney),y1:formatMoneyWithZero(t.FCCB)})}});$("#TotalMoney"+t).html("￥"+formatMoneyWithZero(r)+"元");if(i=="year"){xmax=(new Date).getFullYear()+1;xmin=xmax-7}$("#Charts"+t).children().remove();Charts[t]=Morris.Area({element:"Charts"+t,data:n,xkey:"x",grid:false,ykeys:["y","y1"],labels:["销售金额","销售成本"],lineColors:e.ChartslineColors,gridTextColor:"#fff",parseTime:false,dateFormat:function(e){return e;if(i=="day"){return new Date(e).format("dd").toString()+"日"}else if(i=="month"){return new Date(e).format("MM").toString()+"月"}else if(i=="year"){return new Date(e).format("yyyy").toString()+"年"}},hideHover:"auto"});$("#Chart"+t).hideLoading()}})}function workBook(){$.ajax({type:"POST",url:"/HotMenu/GetWorkBooks",dataType:"json",success:function(e){if(typeof e=="string"){}else{var t=0;$.each(e,function(e,a){var n=$("#myWork");if(a.Rows.length>0){$('<li style=" background-color: #FAF8F8;"><a href="###" style="cursor:default;color: black; font-weight: bolder;">'+a.Title+"</a></li>").appendTo(n)}$.each(a.Rows,function(e,a){var i=parseInt(a.DisplayMember);t+=i;if(i>0){var r=$("<li></li>").appendTo(n);if(a.OperTag){r.click(function(){addTabByID(a.OperTag)})}if(i>0){$('<a  href="###"><div class="clearfix"><span class="pull-left"><i class="'+a.OperTitle+'" style="width: 28px;"></i>&nbsp;'+a.WBTitle+'</span><span class="pull-right badge badge-info">+'+a.DisplayMember+"</span></div></a>").appendTo(r)}else{}}})});if(t>0){$("#myWorkNum").html(t)}else{$('<li style=" background-color: #FAF8F8;height:80px;"><a href="###" style="cursor:default;color: black; font-weight: bolder;">无待处理任务</a></li>').appendTo(myWork)}}}});$.ajax({type:"POST",url:"/HotMenu/GetKCWarring",dataType:"json",success:function(e){if(typeof e=="string"){}else{var t=$("#kcWarring");var a=0;$.each(e,function(e,n){var i=false;if(n.DisplayMember!=null&&parseInt(n.DisplayMember)>0){i=true;a++}if(i){var r=$("<li></li>").appendTo(t);if(n.OperTag){var o="?FastOpen=true";if(n.FastType){o+="&FastType="+n.FastType}r.click(function(){addTabByIDAndParam(n.OperTag,o)})}$('<a  href="###"><div class="clearfix"><span class="pull-left"><i class="'+n.OperTitle+'" style="width: 28px;"></i>&nbsp;'+n.WBTitle+'</span><span class="pull-right"><i class="ace-icon fa fa-bell red"></i></span></div></a>').appendTo(r)}});if(a>0){$("#kcWarringNum").html(a)}else{$('<li style=" background-color: #FAF8F8;height:80px;"><a href="###" style="cursor:default;color: black; font-weight: bolder;">无预警消息</a></li>').appendTo(t)}}}})}function SetFirstPage(){$("body").showLoading();$.ajax({type:"POST",url:"/HotMenu/FirstPageSet",dataType:"json",data:{},success:function(e){if(!(typeof e=="string")){$("#homeDialog").bs_dialog({width:"lg",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-edit orange fa-2x" style="margin-right:5px;"></i>首页配置</h5>',buttons:[{dom:'<button class="btn btn-sm btn-primary"><i class="ace-icon fa fa-save bigger-110"></i><span class="bigger-110">保存</span></button>',handler:function(){SavePageSet()}}],onClose:function(){$("#homeDialog").html("")}});var t=$("#homeDialog");var a=$($('<div class=" col-xs-12" ><div class=" widget-box widget-color-grey ">                                <div class="widget-header">                                    <h4 class="smaller lighter " >显示栏目(拖动可排序)</h4>                                </div>                                <div class="widget-body ">                                    <div class="row" ><div class="col-xs-11 col-sm-11 col-md-10 widget-container-col" id="FPTop"></div>                                    </div></div></div></div>').appendTo(t).find("#FPTop"));$.each(e.NeedShow,function(e,t){if(t.Code=="001"){t.Name="通告&查询"}var n=$('<div class="widget-box col-xs-6 col-sm-4 col-md-3" style="border:0;">                        <label style="padding-top: 10px; padding-bottom: 5px; padding-left: 30px;">                                                      <model class="muted">'+t.Name+'</model>                                                      <input data-code="'+t.Code+'" class="ace ace-switch ace-switch-3" id="ns'+t.Code+'"  type="checkbox"  value="false">                                                      <span class="lbl middle"></span>                                                  </label></div>').appendTo(a);if(t.isShow){$("#ns"+t.Code).attr("checked","checked")}});var n=$($('<div class="col-sm-12 col-xs-12" style="padding-top: 20px;" ><div class=" widget-box widget-color-grey ">                                <div class="widget-header">                                    <h4 class="smaller lighter " >统计卡片</h4>                                </div>                                <div class="widget-body ">                                    <div class="row" id="FPCent"></div></div></div></div>').appendTo(t).find("#FPCent"));$.each(e.CountMark,function(e,t){var a=$('<div class="col-xs-4 col-sm-4" style="padding-top: 15px; padding-left: 30px;"><label >                                                      <model class="muted">'+t.Name+'</model>                                                      <input data-code="'+t.Code+'" class="ace ace-switch ace-switch-3" id="ck'+t.Code+'"  type="checkbox"  value="false">                                                      <span class="lbl middle"></span>                                                  </label></div>').appendTo(n);if(t.isShow){$("#ck"+t.Code).prop("checked",true)}});var i=$($('<div class="col-sm-12  col-xs-12" style="padding-top: 20px;" ><div class=" widget-box widget-color-grey ">                                <div class="widget-header">                                    <h4 class="smaller lighter " >统计图表</h4>                                </div>                                <div class="widget-body ">                                    <div class="row" id="FPBot"></div></div></div></div>').appendTo(t).find("#FPBot"));$.each(e.ChartList,function(e,t){var a=$('<div class="col-xs-4 col-sm-4" style="padding-top: 15px; padding-left: 30px;"><label>                                                      <model class="muted">'+t.Name+'</model>                                                      <input data-code="'+t.Code+'" class="ace ace-switch ace-switch-3" id="cl'+t.Code+'"  type="checkbox"  value="false">                                                      <span class="lbl middle"></span>                                                  </label></div>').appendTo(i);if(t.isShow){$("#cl"+t.Code).attr("checked","checked")}});$(".widget-container-col").sortable({connectWith:".widget-container-col",items:"> .widget-box",handle:ace.vars["touch"]?".widget-header":false,cancel:".fullscreen",opacity:.8,revert:true,forceHelperSize:true,placeholder:"widget-placeholder",forcePlaceholderSize:true,tolerance:"pointer",start:function(e,t){t.item.parent().css({"min-height":t.item.height()})},update:function(e,t){t.item.parent({"min-height":""})}});$("#homeDialog").removeClass("hidden");$("#homeDialog").bs_dialog("open");$("body").hideLoading()}else{$.messager.alert("操作提示",e,"warning")}}})}function SavePageSet(){$.messager.confirm("操作提示","点击确定后将会刷新整个页面,未保存的数据将会丢失!",function(e){if(!e){return}isLogOut=true;var t="",a="",n="";$.each($("#FPTop").find("input"),function(e,a){if(a.checked){t+=$(a).attr("data-code")+":true"+","}else{t+=$(a).attr("data-code")+":false"+","}});$.each($("#FPCent").find("input"),function(e,t){if(t.checked){a+=$(t).attr("data-code")+","}});$.each($("#FPBot").find("input"),function(e,t){if(t.checked){n+=$(t).attr("data-code")+","}});$.ajax({type:"POST",url:"/HotMenu/FirstPageSave",dataType:"json",data:{NeedShow:t,CountMark:a,ChartList:n},success:function(e){if(e!=""){$.messager.alert("操作提示",e,"warning")}else{location.reload(true)}}});$("#homeDialog").bs_dialog("close")})}function ShowInform(){if($("#MainInfo").length>0){$.ajax({type:"POST",url:"/HotMenu/GetNews",dataType:"json",data:{},success:function(e){if(e.error){return}var t=$("#MainInfo").find("ul");$.each(e,function(e,a){var n=StringToJson(a);$('<li><a href="/UseCookie/gotoUrl?url='+n.url.replace(/Cloud_News/g,"News")+'&noLogin=1" target="_blank" title="'+n.title+'">'+n.title+"</a></li>").appendTo(t)});initnewsAni()}})}}function GetFastMenu(e){$.ajax({type:"POST",url:"/HotMenu/GetData",dataType:"json",success:function(t){if(typeof t=="string"){}else{ShowFastMenu(t);if(e!=null)e.trigger("reloaded.ace.widget")}}})}function ShowFastMenu(e){var t=$($("#fastMenu").find("div.left"));var a=$($("#fastMenu").find("div.right"));t.html("").unbind("click");a.html("").unbind("click");var n=[{btn:" btn-light ",i:" green "},{btn:" btn-light ",i:" text-primary "},{btn:" btn-light ",i:" grey "}];$.each(e,function(e,i){if(e<=7){var r="btn btn-app no-radius ";var o=parseInt(10*Math.random())*2;var s=parseInt(10*Math.random())*2;var l="";if(i.MnuName.length>=6){l=" style='font-size: 14px;' ";if(i.MnuName.length>=8){l=" style='font-size: 12px;' "}}var c=$('<div class="col-md-3 col-sm-6 col-xs-6 "><div class="row"><div class="col-xs-12"><a class="'+r+n[o%3].btn+'" href="###"  ><i class="ace-icon fa '+n[s%3].i+i.Icon+' bigger-230"></i><span class="'+n[s%3].i+'" '+l+">"+i.MnuName+"</span></a></div></div></div>").appendTo(e<4?t:a);c.find("a").click(function(){addTab(i.MenuID,i.MnuName,"/"+i.URI,i.Icon,i.ObjID)})}})}function RefreshCm(e){$("#cm"+e).showLoading();ShowCountMark(e,$("#cm"+e))}function ShowCountMark(e,t){$.ajax({type:"POST",url:"/SYChart/GetCountMark",dataType:"json",data:{Codes:e},success:function(e){ex_afterCMSuccess();if(typeof e=="string"){if(t!=null)t.hideLoading()}else{if(t!=null)t.hideLoading();PaintCountMark(e)}}})}function PaintCountMark(e){$.each(e,function(t,a){if($("#cm"+a.CMCode).length>0){var n=$("#cm"+a.CMCode);$("#h2"+a.CMCode1).html(0);var i=a.count1.replace(/,/g,"");$({numberValue:0}).animate({numberValue:i},{duration:1e3,easing:"linear",complete:function(){$("#h2"+a.CMCode1).html(a.count1)},step:function(){$("#h2"+a.CMCode1).text(parseFloat(this.numberValue).toFixed(2))}});if(a.CMCode2){$("#h2"+a.CMCode2).html(0);var r=a.count2.replace(/,/g,"");$({numberValue:0}).animate({numberValue:r},{duration:1e3,easing:"linear",complete:function(){$("#h2"+a.CMCode2).html(a.count2)},step:function(){$("#h2"+a.CMCode2).text(parseFloat(this.numberValue).toFixed(2))}})}else if(!a.newCard){var r=parseFloat(a.count2.replace(/,/g,""));var o="down";if(r>0)o="up";if(r==0)o="right";n.find("div.count2").html('<i class="fa fa-arrow-circle-o-'+o+' fa-lg  bigger-150"></i><span class="m-left-xs"  style="font-size: 15px;">'+(r>=0?r:-r)+a.Info+"</span>")}}else{return;var s=typeof e=="string"?JSON.parse(a.ShowJson):a.ShowJson;var l=$('<div class="col-sm-6 col-md-3"></div>').appendTo($("#CountMark"));var n=$('<div class="panel-stat3 no-radius '+s.backColor+'" id="cm'+a.CMCode+'" style="margin-bottom: 5px;margin-top: 5px;padding-top: 15px; padding-bottom: 15px;height: 137px;"></div>').appendTo(l);var c=$('<div style="height: 41px;"></div>').appendTo(n);var d=$('<div style="height: 41px; margin-top: 20px;"></div>').appendTo(n);$('<h2 class="m-top-none" id="h2'+a.CMCode1+'" style="margin-bottom: 0px;">'+0+"</h2>").appendTo(c);$('<h5 style="margin-top: 2px; margin-bottom: 0px;">'+a.CMTitle1+"</h5>").appendTo(c);if(a.CMCode2){$('<h2 class="m-top-none" id="h2'+a.CMCode2+'" style="margin-bottom: 0px;">'+0+"</h2>").appendTo(d);$('<h5 style="margin-top: 2px; margin-bottom: 0px;">'+a.CMTitle2+"</h5>").appendTo(d)}else if(s.fa!=null)$('<div class="count2" style="padding-top: 10px;"><i class="fa fa-arrow-circle-o-up fa-lg  bigger-150"></i><span class="m-left-xs" style="font-size: 15px;">'+0+s.fa+"</span></div>").appendTo(d);else $('<h2 class="m-top-none" id="h20102" style="margin-bottom: 0px;">0</h2><h5 style="margin-top: 2px; margin-bottom: 0px;">库存成本统计</h5>').appendTo(d);if(s.icon!=null)$('<div class="stat-icon"><i class="fa '+s.icon+' fa-3x"></i></div>').appendTo(n);$('<div class="refresh-button"><i class="fa fa-refresh"></i></div>').appendTo(n).click(function(){var e=$($(this).parent());e.showLoading();ShowCountMark(a.CMCode,e)});$('<div class="loading-overlay"><i class="loading-icon fa fa-refresh fa-spin fa-lg"></i></div>').appendTo(n)}})}function RefreshCs(e){$("#Chart"+e).showLoading();var t=$("#dropdown_SreachType"+e).find("li.active").data("chart");GetChartSetting(e,t,$("#Chart"+e))}function DropdownChartSetting(e){var t=null,a=null;var n=$(e.target).closest("li");t=n.data("chart");a=n.data("code");if(!t){return}$("#dropdown_SreachType"+a).find("li").removeClass("active");$(e.target).closest("li").addClass("active");$("#Chart"+a).showLoading();GetChartSetting(a,t,$("#Chart"+a))}function GetChartSetting(e,t,a){var n=$("#Chart"+e).data("url");$.ajax({type:"POST",url:n,dataType:"json",data:{dateType:t},success:function(t){ex_afterCSSuccess();if(typeof t=="string"||t.error){if(a!=null)a.hideLoading()}else{ShowChartSetting(t,e)}}})}function ShowChartSetting(e,t){var a="#ffffff";var n=["#b74635","#4f99c6","#e59729","#87b87f"];a=parseInt($("#Chart"+t).data("num"))%4;$("#Charts"+t).children().remove();$("#Ctitle"+t).html(e.title);$("#TotalMoney"+t+"01").html("￥"+e.total+"元");if(e.total1){$("#TotalMoney"+t+"02").html("￥"+e.total1+"元")}var i=parseFloat(e.total.replace(/,/g,""));if(e.rows.length==0||i==0){$('<div class="center" style="padding-top: 30px;color: #ccc;"><i class="fa fa-5x fa-frown-o bigger-900" style="font-size: 100px;"></i>暂无数据......</div>').appendTo($("#Charts"+t));$("#Chart"+t).hideLoading();return}switch(e.charttype){case 1:Charts["Charts"+t]=Morris.Line({element:"Charts"+t,data:e.rows,xkey:"x",grid:true,gridLineColor:"#CCC",hideHover:true,ykeys:["y"],labels:[e.label],lineColors:[n[a]],gridTextColor:"#666",gridTextSize:"11px",parseTime:false,dateFormat:function(e){return e;if(datetype=="day"){return new Date(e).format("dd").toString()+"日"}else if(datetype=="month"){return new Date(e).format("MM").toString()+"月"}else if(datetype=="year"){return new Date(e).format("yyyy").toString()+"年"}}});break;case 2:Charts["Charts"+t]=Morris.Area({element:"Charts"+t,data:e.rows,grid:true,gridLineColor:"#ffffff",xkey:"x",ykeys:["y"],labels:[e.label],areaColors:["#538792"],gridTextColor:"#ffffff",parseTime:false,dateFormat:function(e){return e;if(datetype=="day"){return new Date(e).format("dd").toString()+"日"}else if(datetype=="month"){return new Date(e).format("MM").toString()+"月"}else if(datetype=="year"){return new Date(e).format("yyyy").toString()+"年"}}});break;case 3:Charts["Charts"+t]=Morris.Bar({element:"Charts"+t,data:e.rows,xkey:"x",ykeys:["y"],grid:true,gridLineColor:"#CCC",labels:[e.label],barColors:[n[a]],gridTextColor:"#666",gridTextSize:"11px",hoverCallback:function(e,t,a){
return a},parseTime:true,pointSize:2,hideHover:true});break;case 4:var r=[];if(e.rows.length>1){$.each(e.rows,function(e,t){var a=t.y*100/i;if(a>0){r.push({label:t.x,value:formatMoneyWithZero(a)})}})}else{r.push({label:e.rows[0].x,value:100})}Charts["Charts"+t]=Morris.Donut({element:"Charts"+t,data:r,colors:["#b74635","#4f99c6","#e59729","#87b87f","#fc8675","#6bafbd","#f3ce85","#65cea7"],formatter:function(e){return e+"%"}}).on("click",function(e,t){});break;default:break}$("#Chart"+t).hideLoading()}var showUserConnInfo=function(){if(isLearn=="true"){return}if(!$("#connUserInfo").hasClass("bs_dialog")){$("#connUserInfo").bs_dialog({width:"",title:'<h5 style="margin-top:5px;margin-bottom:5px;"><i class="ace-icon fa fa-users fa-2x green" style="margin-right:5px;"></i>在线用户</h5>',backdrop:true,keyboard:true,buttons:[],onShow:function(){getUserConnData()}});$("#connUserInfo").removeClass("hidden");var e={iconCls:"icon-table",fit:true,singleSelect:true,loadMsg:"正在加载列表数据，请稍等....",border:true,fitColumns:false,frozenColumns:[[]],columns:[[{title:"云账号",field:"usercode",halign:"center",width:100},{title:"用户名称",field:"username",halign:"center",width:100},{title:"所属机构",field:"unitname",halign:"center",width:150},{title:"登陆时间",field:"logintime",halign:"center",width:150}]],checkOnSelect:false,selectOnCheck:false};$("#tt_connUserInfo").datagrid(e);$("#btnHeCut").on("click",function(e){var t=$(this);var a=$("#tt_connUserInfo").datagrid("getSelected");if(!a){$.messager.alert("","请选择您要强制下线的用户！");return}$.messager.confirm("","您确定要将用户["+a.usercode+"]强制下线吗？",function(e){if(e==false){return}$.ajax({type:"POST",url:"/UserConn/CutConn",data:{connID:a.connid},dataType:"json",success:function(e){if(e.error){$.messager.alert("",e.error);return}getUserConnData();return}})})})}$("#connUserInfo").bs_dialog("open")};var getUserConnData=function(){$("#connUserInfo").bs_dialog("showLoading");$.ajax({type:"POST",url:"/UserConn/GetUserConnInfo",dataType:"json",success:function(e){$("#connUserInfo").bs_dialog("hideLoading");if(e.error){$.messager.alert("",e.error,"");return}$("#tt_connUserInfo").datagrid("loadData",e)}})};var fp_showFullScreen=function(){$("#myTabContent").addClass("mx_fullscreen");resizetabs()};var fp_hideFullScreen=function(){$("#myTabContent").removeClass("mx_fullscreen");resizetabs()};function getSearchCode(e){var t=$("#myTab").find("li.active").attr("tagid");var a=$("#tab-"+t);var n=a.find("iframe");try{n[0].contentWindow.getSearchCode(e)}catch(i){alert("error")}}var initQuickSearch=function(){$("#qs_btn").on("click",function(e){quickSearch($("#qs_input").val())});$("#qs_input").on("keydown",function(e){var t=window.event?true:false;var a;var n;if(!e){return}if(t){a=e.keyCode;n=e}else{a=e.which;n=e}if(a==13){quickSearch($("#qs_input").val())}})};var quickSearch=function(e){addTab("inv_quickSearch","快捷查询","/Home/quickSearch?info="+e,"fa-search-plus","")};var resize_dhbar=function(){var e=$($("#myTab").find("li.active:not(.tabdrop)"));var t=e.attr("tagid");var a=false;if(t&&t!="menuFirstPage"){a=true}else{a=false}if($.browser.useapp){$("body").addClass("mx-xs")}else{$("body").removeClass("mx-xs")}if($.browser.useapp&&a){$("#navbar").addClass("hidden");$("#myTab").closest(".widget-header").addClass("hidden");hidemenu()}else{$("#navbar").removeClass("hidden");$("#myTab").closest(".widget-header").removeClass("hidden")}};var returnFirstPage=function(){showFirstPage();resize_dhbar()};var hidemenu=function(){var e=$("button.menu-toggler");var t=$(e.attr("data-target"));if(t.length==0)return;if(!e.hasClass("display")){return}t.toggleClass("display");e.toggleClass("display");var a=ace.click_event+".ace.autohide";var n=t.attr("data-auto-hide")==="true";if(e.hasClass("display")){if(n){$(document).on(a,function(n){if(t.get(0)==n.target||$.contains(t.get(0),n.target)){n.stopPropagation();return}t.removeClass("display");e.removeClass("display");$(document).off(a)})}if(t.attr("data-sidebar-scroll")=="true")t.ace_sidebar_scroll("reset")}else{}};